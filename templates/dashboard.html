
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Licensing Analysis Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .metric-card { background: white; border-radius: 10px; padding: 20px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .chart-container { background: white; border-radius: 10px; padding: 20px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .metric-value { font-size: 2rem; font-weight: bold; color: #007bff; }
        .metric-label { color: #6c757d; font-size: 0.9rem; }
        .table-container { background: white; border-radius: 10px; padding: 20px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .nav-tabs .nav-link { color: #495057; }
        .nav-tabs .nav-link.active { color: #007bff; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center my-4">Licensing Analysis Dashboard</h1>
                <p class="text-center text-muted">Real-time analysis of licensing costs and industry benchmarks (2024-2025)</p>
            </div>
        </div>
        
        <!-- Summary Metrics -->
        <div class="row" id="summary-metrics">
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="total-spend">$0</div>
                    <div class="metric-label">Total Spend</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="total-invoices">0</div>
                    <div class="metric-label">Total Invoices</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="vendor-count">0</div>
                    <div class="metric-label">Vendors</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="company-count">0</div>
                    <div class="metric-label">Companies</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="avg-invoice">$0</div>
                    <div class="metric-label">Avg Invoice</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="years-analyzed">-</div>
                    <div class="metric-label">Years Analyzed</div>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 1 -->
        <div class="row">
            <div class="col-md-6">
                <div class="chart-container">
                    <div id="spending-pie-chart"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <div id="vendor-bar-chart"></div>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 2 -->
        <div class="row">
            <div class="col-md-6">
                <div class="chart-container">
                    <div id="company-bar-chart"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <div id="vendor-company-heatmap"></div>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 3 -->
        <div class="row">
            <div class="col-md-6">
                <div class="chart-container">
                    <div id="monthly-trend-chart"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <div id="yearly-comparison-chart"></div>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 4 -->
        <div class="row">
            <div class="col-12">
                <div class="chart-container">
                    <div id="enhanced-benchmark-chart"></div>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 5 -->
        <div class="row">
            <div class="col-12">
                <div class="chart-container">
                    <div id="benchmark-comparison-chart"></div>
                </div>
            </div>
        </div>
        
        <!-- Details Tables -->
        <div class="row">
            <div class="col-12">
                <div class="table-container">
                    <ul class="nav nav-tabs" id="detailsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="category-tab" data-bs-toggle="tab" data-bs-target="#category-tab-pane" type="button" role="tab">Category Details</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="company-tab" data-bs-toggle="tab" data-bs-target="#company-tab-pane" type="button" role="tab">Company Details</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="benchmark-tab" data-bs-toggle="tab" data-bs-target="#benchmark-tab-pane" type="button" role="tab">Benchmark Analysis</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="recommendations-tab" data-bs-toggle="tab" data-bs-target="#recommendations-tab-pane" type="button" role="tab">Recommendations</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="ai-insights-tab" data-bs-toggle="tab" data-bs-target="#ai-insights-tab-pane" type="button" role="tab">AI Insights</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="detailsTabsContent">
                        <div class="tab-pane fade show active" id="category-tab-pane" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-striped" id="category-table">
                                    <thead>
                                        <tr>
                                            <th>Category</th>
                                            <th>Total Spend</th>
                                            <th>Percentage</th>
                                            <th>Invoice Count</th>
                                            <th>Avg Invoice</th>
                                        </tr>
                                    </thead>
                                    <tbody id="category-tbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="company-tab-pane" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-striped" id="company-table">
                                    <thead>
                                        <tr>
                                            <th>Company</th>
                                            <th>Total Spend</th>
                                            <th>Percentage</th>
                                        </tr>
                                    </thead>
                                    <tbody id="company-tbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="benchmark-tab-pane" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-striped" id="benchmark-table">
                                    <thead>
                                        <tr>
                                            <th>Category</th>
                                            <th>Actual Spend</th>
                                            <th>Benchmark (Low)</th>
                                            <th>Benchmark (High)</th>
                                            <th>Benchmark (Typical)</th>
                                            <th>Variance</th>
                                            <th>Status</th>
                                            <th>% of Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="benchmark-tbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="recommendations-tab-pane" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-striped" id="recommendations-table">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>Category/Vendor/Company</th>
                                            <th>Priority</th>
                                            <th>Message</th>
                                            <th>Potential Savings</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recommendations-tbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="ai-insights-tab-pane" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <div id="ai-enhanced-chart"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="table-responsive">
                                        <h5>AI Categorizations</h5>
                                        <table class="table table-striped" id="ai-categorizations-table">
                                            <thead>
                                                <tr>
                                                    <th>Vendor</th>
                                                    <th>Category</th>
                                                    <th>Subcategory</th>
                                                    <th>Service Type</th>
                                                    <th>Complexity</th>
                                                </tr>
                                            </thead>
                                            <tbody id="ai-categorizations-tbody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="table-responsive">
                                        <h5>Hidden Costs Identified</h5>
                                        <table class="table table-striped" id="hidden-costs-table">
                                            <thead>
                                                <tr>
                                                    <th>Hidden Cost</th>
                                                    <th>Frequency</th>
                                                </tr>
                                            </thead>
                                            <tbody id="hidden-costs-tbody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="table-responsive">
                                        <h5>MSP Services Analysis</h5>
                                        <table class="table table-striped" id="msp-services-table">
                                            <thead>
                                                <tr>
                                                    <th>Vendor</th>
                                                    <th>Services</th>
                                                </tr>
                                            </thead>
                                            <tbody id="msp-services-tbody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load summary metrics
        $.get('/api/summary', function(data) {
            $('#total-spend').text(data.total_spend);
            $('#total-invoices').text(data.total_invoices);
            $('#vendor-count').text(data.vendor_count);
            $('#company-count').text(data.company_count);
            $('#avg-invoice').text(data.avg_invoice);
            $('#years-analyzed').text(data.years_analyzed);
        });
        
        // Load category details
        $.get('/api/categories', function(data) {
            const tbody = $('#category-tbody');
            tbody.empty();
            
            data.forEach(function(category) {
                tbody.append(`
                    <tr>
                        <td>${category.category}</td>
                        <td>${category.spend}</td>
                        <td>${category.percentage}</td>
                        <td>${category.invoice_count}</td>
                        <td>${category.avg_invoice}</td>
                    </tr>
                `);
            });
        });
        
        // Load company details
        $.get('/api/companies', function(data) {
            const tbody = $('#company-tbody');
            tbody.empty();
            
            data.forEach(function(company) {
                tbody.append(`
                    <tr>
                        <td>${company.company}</td>
                        <td>${company.spend}</td>
                        <td>${company.percentage}</td>
                    </tr>
                `);
            });
        });
        
        // Load charts
        $.get('/api/charts/spending-pie', function(data) {
            Plotly.newPlot('spending-pie-chart', JSON.parse(data).data, JSON.parse(data).layout);
        });
        
        $.get('/api/charts/vendor-bar', function(data) {
            Plotly.newPlot('vendor-bar-chart', JSON.parse(data).data, JSON.parse(data).layout);
        });
        
        $.get('/api/charts/company-bar', function(data) {
            Plotly.newPlot('company-bar-chart', JSON.parse(data).data, JSON.parse(data).layout);
        });
        
        $.get('/api/charts/vendor-company-heatmap', function(data) {
            Plotly.newPlot('vendor-company-heatmap', JSON.parse(data).data, JSON.parse(data).layout);
        });
        
        $.get('/api/charts/monthly-trend', function(data) {
            if (data) {
                Plotly.newPlot('monthly-trend-chart', JSON.parse(data).data, JSON.parse(data).layout);
            } else {
                $('#monthly-trend-chart').html('<p class="text-center text-muted">No monthly data available</p>');
            }
        });
        
        $.get('/api/charts/yearly-comparison', function(data) {
            if (data) {
                Plotly.newPlot('yearly-comparison-chart', JSON.parse(data).data, JSON.parse(data).layout);
            } else {
                $('#yearly-comparison-chart').html('<p class="text-center text-muted">No yearly data available</p>');
            }
        });
        
        $.get('/api/charts/enhanced-benchmark', function(data) {
            if (data) {
                Plotly.newPlot('enhanced-benchmark-chart', JSON.parse(data).data, JSON.parse(data).layout);
            } else {
                $('#enhanced-benchmark-chart').html('<p class="text-center text-muted">No benchmark data available</p>');
            }
        });
        
        $.get('/api/charts/benchmark-comparison', function(data) {
            if (data) {
                Plotly.newPlot('benchmark-comparison-chart', JSON.parse(data).data, JSON.parse(data).layout);
            } else {
                $('#benchmark-comparison-chart').html('<p class="text-center text-muted">No benchmark data available</p>');
            }
        });
        
        // Load benchmark details
        $.get('/api/benchmarks', function(data) {
            const tbody = $('#benchmark-tbody');
            tbody.empty();
            
            data.forEach(function(benchmark) {
                tbody.append(`
                    <tr>
                        <td>${benchmark.category}</td>
                        <td>${benchmark.actual_spend}</td>
                        <td>${benchmark.benchmark_low}</td>
                        <td>${benchmark.benchmark_high}</td>
                        <td>${benchmark.benchmark_typical}</td>
                        <td>${benchmark.variance_percentage}</td>
                        <td>${benchmark.status}</td>
                        <td>${benchmark.percentage_of_total}</td>
                    </tr>
                `);
            });
        });
        
        // Load recommendations
        $.get('/api/recommendations', function(data) {
            const tbody = $('#recommendations-tbody');
            tbody.empty();
            
            data.forEach(function(rec) {
                const categoryVendorCompany = rec.category || rec.vendor || rec.company || 'N/A';
                tbody.append(`
                    <tr>
                        <td>${rec.type}</td>
                        <td>${categoryVendorCompany}</td>
                        <td><span class="badge bg-${rec.priority === 'High' ? 'danger' : rec.priority === 'Medium' ? 'warning' : 'success'}">${rec.priority}</span></td>
                        <td>${rec.message}</td>
                        <td>${rec.potential_savings}</td>
                    </tr>
                `);
            });
        });
        
        // Load AI-enhanced insights
        $.get('/api/ai-insights', function(data) {
            // Load AI categorizations
            const catTbody = $('#ai-categorizations-tbody');
            catTbody.empty();
            
            data.ai_categorizations.forEach(function(cat) {
                catTbody.append(`
                    <tr>
                        <td>${cat.vendor}</td>
                        <td>${cat.category}</td>
                        <td>${cat.subcategory}</td>
                        <td>${cat.service_type}</td>
                        <td>${cat.complexity_level}</td>
                    </tr>
                `);
            });
            
            // Load hidden costs
            const hiddenCostsTbody = $('#hidden-costs-tbody');
            hiddenCostsTbody.empty();
            
            const costFrequency = {};
            data.hidden_costs.forEach(function(cost) {
                costFrequency[cost] = (costFrequency[cost] || 0) + 1;
            });
            
            Object.entries(costFrequency).forEach(function([cost, frequency]) {
                hiddenCostsTbody.append(`
                    <tr>
                        <td>${cost}</td>
                        <td>${frequency}</td>
                    </tr>
                `);
            });
            
            // Load MSP services
            const mspTbody = $('#msp-services-tbody');
            mspTbody.empty();
            
            data.msp_analysis.forEach(function(msp) {
                mspTbody.append(`
                    <tr>
                        <td>${msp.vendor}</td>
                        <td>${msp.services.join(', ')}</td>
                    </tr>
                `);
            });
        });
        
        // Load AI-enhanced chart
        $.get('/api/charts/ai-enhanced', function(data) {
            if (data) {
                Plotly.newPlot('ai-enhanced-chart', JSON.parse(data).data, JSON.parse(data).layout);
            } else {
                $('#ai-enhanced-chart').html('<p class="text-center text-muted">No AI-enhanced data available</p>');
            }
        });
        
        // Auto-refresh every 30 seconds
        setInterval(function() {
            location.reload();
        }, 30000);
    </script>
</body>
</html>
    